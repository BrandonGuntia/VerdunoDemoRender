{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
<div class="main">
<div class="dashboard-header">
<h1>ðŸ“Š Admin Dashboard</h1>
<div class="welcome-message">
<span id="welcomeText">Welcome, Admin</span>
<button onclick="logout()" class="logout-btn">Logout</button>
</div>
</div>

<!-- çµ±è¨ˆå¡ç‰‡ -->
<div class="stats-grid">
<div class="stat-card stat-products">
<div class="stat-icon">ðŸ“¦</div>
<div class="stat-info">
<div class="stat-value" id="totalProducts">0</div>
<div class="stat-label">Products</div>
</div>
<a href="/products" class="stat-link">View All â†’</a>
</div>

<div class="stat-card stat-customers">
<div class="stat-icon">ðŸ‘¥</div>
<div class="stat-info">
<div class="stat-value" id="totalCustomers">0</div>
<div class="stat-label">Customers</div>
</div>
<a href="/customers" class="stat-link">View All â†’</a>
</div>

<div class="stat-card stat-invoices">
<div class="stat-icon">ðŸ“„</div>
<div class="stat-info">
<div class="stat-value" id="totalInvoices">0</div>
<div class="stat-label">Invoices</div>
</div>
<a href="/invoices" class="stat-link">View All â†’</a>
</div>

<div class="stat-card stat-revenue">
<div class="stat-icon">ðŸ’°</div>
<div class="stat-info">
<div class="stat-value" id="totalRevenue">$0</div>
<div class="stat-label">Total Revenue</div>
</div>
<a href="/invoices" class="stat-link">View Details â†’</a>
</div>
</div>

<!-- å¿«é€Ÿæ“ä½œ -->
<div class="quick-actions">
<h2>âš¡ Quick Actions</h2>
<div class="actions-grid">
<a href="/products" class="action-card">
<div class="action-icon">ðŸ“¦</div>
<div class="action-title">Manage Products</div>
<div class="action-desc">Add, edit, or delete products</div>
</a>

<a href="/customers" class="action-card">
<div class="action-icon">ðŸ‘¥</div>
<div class="action-title">Manage Customers</div>
<div class="action-desc">View and manage customer accounts</div>
</a>

<a href="/testing-input" class="action-card">
<div class="action-icon">ðŸ›’</div>
<div class="action-title">Create Order</div>
<div class="action-desc">Test order input system</div>
</a>

<a href="/invoices" class="action-card">
<div class="action-icon">ðŸ“„</div>
<div class="action-title">View Invoices</div>
<div class="action-desc">Manage all invoices</div>
</a>

<a href="/cutting-list" class="action-card">
<div class="action-icon">ðŸ“‹</div>
<div class="action-title">Cutting List</div>
<div class="action-desc">Production schedule</div>
</a>
</div>
</div>
</div>

<style>
.dashboard-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 30px;
padding-bottom: 20px;
border-bottom: 2px solid #e0e0e0;
}

.dashboard-header h1 {
color: #264653;
font-size: 2em;
}

.welcome-message {
display: flex;
align-items: center;
gap: 15px;
}

#welcomeText {
color: #666;
font-size: 1.1em;
}

.logout-btn {
padding: 10px 20px;
background-color: #e76f51;
color: white;
border: none;
border-radius: 6px;
cursor: pointer;
font-weight: 600;
transition: all 0.3s ease;
}

.logout-btn:hover {
background-color: #d15b42;
transform: translateY(-2px);
}

.stats-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 20px;
margin-bottom: 40px;
}

.stat-card {
background: white;
border-radius: 12px;
padding: 25px;
box-shadow: 0 4px 6px rgba(0,0,0,0.1);
transition: all 0.3s ease;
display: flex;
flex-direction: column;
gap: 15px;
}

.stat-card:hover {
transform: translateY(-5px);
box-shadow: 0 8px 15px rgba(0,0,0,0.15);
}

.stat-products { border-left: 4px solid #2a9d8f; }
.stat-customers { border-left: 4px solid #e76f51; }
.stat-invoices { border-left: 4px solid #f4a261; }
.stat-revenue { border-left: 4px solid #52b788; }

.stat-card .stat-icon {
font-size: 3em;
}

.stat-info {
flex: 1;
}

.stat-value {
font-size: 2.5em;
font-weight: bold;
color: #264653;
line-height: 1;
margin-bottom: 5px;
}

.stat-label {
color: #666;
font-size: 0.95em;
text-transform: uppercase;
letter-spacing: 0.5px;
}

.stat-link {
color: #2a9d8f;
text-decoration: none;
font-weight: 600;
font-size: 0.9em;
transition: all 0.2s ease;
}

.stat-link:hover {
color: #21867a;
}

.quick-actions {
background: white;
border-radius: 12px;
padding: 30px;
box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.quick-actions h2 {
color: #264653;
margin-bottom: 25px;
font-size: 1.5em;
}

.actions-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 20px;
}

.action-card {
background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
border-radius: 10px;
padding: 20px;
text-decoration: none;
transition: all 0.3s ease;
border: 2px solid transparent;
}

.action-card:hover {
transform: translateY(-3px);
border-color: #2a9d8f;
box-shadow: 0 6px 12px rgba(42, 157, 143, 0.2);
}

.action-icon {
font-size: 2.5em;
margin-bottom: 10px;
}

.action-title {
font-size: 1.1em;
font-weight: bold;
color: #264653;
margin-bottom: 5px;
}

.action-desc {
font-size: 0.85em;
color: #666;
}
</style>

<script>
// é é¢è¼‰å…¥æ™‚ç²å–çµ±è¨ˆæ•¸æ“š
window.addEventListener('DOMContentLoaded', function() {
checkSession();
loadDashboardStats();
});

// æª¢æŸ¥ç™»å…¥ç‹€æ…‹
function checkSession() {
fetch('/api/auth/check-session', {
credentials: 'include'
})
.then(response => response.json())
.then(data => {
if (!data.logged_in) {
window.location.href = '/login';
} else if (data.user_type !== 'admin') {
// å¦‚æžœä¸æ˜¯ adminï¼Œé‡å®šå‘åˆ° testing-input
window.location.href = '/testing-input';
} else {
// é¡¯ç¤ºç”¨æˆ¶å
document.getElementById('welcomeText').textContent = `Welcome, ${data.username}`;
}
})
.catch(error => {
console.error('Session check error:', error);
window.location.href = '/login';
});
}

// è¼‰å…¥çµ±è¨ˆæ•¸æ“š
function loadDashboardStats() {
// è¼‰å…¥ç”¢å“çµ±è¨ˆ
fetch('/api/products')
.then(response => response.json())
.then(products => {
document.getElementById('totalProducts').textContent = products.length;
})
.catch(error => console.error('Error loading products:', error));

// è¼‰å…¥å®¢æˆ¶çµ±è¨ˆ
fetch('/api/customers')
.then(response => response.json())
.then(customers => {
document.getElementById('totalCustomers').textContent = customers.length;
})
.catch(error => console.error('Error loading customers:', error));

// è¼‰å…¥ç™¼ç¥¨çµ±è¨ˆ
fetch('/api/invoices')
.then(response => response.json())
.then(invoices => {
document.getElementById('totalInvoices').textContent = invoices.length;
// è¨ˆç®—ç¸½æ”¶å…¥
const totalRevenue = invoices.reduce((sum, inv) => sum + inv.total_amount, 0);
document.getElementById('totalRevenue').textContent = `${totalRevenue.toFixed(2)}`;
})
.catch(error => console.error('Error loading invoices:', error));
}

// ç™»å‡ºåŠŸèƒ½
function logout() {
if (confirm('Are you sure you want to logout?')) {
fetch('/api/auth/logout', {
method: 'POST',
credentials: 'include'
})
.then(response => response.json())
.then(data => {
alert(data.message);
window.location.href = '/login';
})
.catch(error => {
console.error('Logout error:', error);
window.location.href = '/login';
});
}
}
</script>
{% endblock %}