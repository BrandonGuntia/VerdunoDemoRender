{% extends "base.html" %}
{% block title %}Product Database{% endblock %}
{% block content %}
<div class="main">
<div class="card">
<h2>Welcome to Product Database</h2>

<!-- æœç´¢æ¬„ -->
<div class="search-container">
<input id="searchInput" type="text" placeholder="ğŸ” Search by ID or Name..." onkeyup="handleSearch(event)">
<button onclick="searchProducts()" class="btn-search">Search</button>
<button onclick="clearSearch()" class="btn-clear">Clear</button>
</div>

<div id="productContainer" class="product-container"></div>

<h3>Add Product</h3>
<input id="productId" placeholder="Product ID">
<input id="name" placeholder="Product Name">
<input id="price" placeholder="Price" type="number" step="0.01">
<input id="subclass" placeholder="Subclass">
<button onclick="add_product()">Add</button>
</div>
</div>
<style>
.search-container {
    display: flex;
    gap: 10px;
    margin: 20px 0;
    align-items: center; /* å‚ç›´å±…ä¸­å°é½Š */
}

#searchInput {
    flex: 0 0 50%; /* å›ºå®šä½” 50% å¯¬åº¦ */
    padding: 12px 15px; /* å¢åŠ å…§é‚Šè·è®“è¼¸å…¥æ¡†æ›´èˆ’é© */
    border: 2px solid #2a9d8f;
    border-radius: 6px; /* å¢åŠ åœ“è§’ */
    font-size: 1em;
    transition: all 0.3s ease; /* æ·»åŠ å¹³æ»‘éæ¸¡æ•ˆæœ */
}

#searchInput:focus {
    outline: none;
    border-color: #21867a;
    box-shadow: 0 0 8px rgba(42, 157, 143, 0.4); /* å¢å¼·é™°å½±æ•ˆæœ */
    transform: translateY(-1px); /* è¼•å¾®ä¸Šç§»æ•ˆæœ */
}

.btn-search {
    flex: 0 0 25%; /* å›ºå®šä½” 25% å¯¬åº¦ */
    padding: 12px 20px;
    background: linear-gradient(135deg, #2a9d8f 0%, #21867a 100%); /* æ¼¸è®ŠèƒŒæ™¯ */
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600; /* åŠ ç²—å­—é«” */
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(42, 157, 143, 0.2); /* æ·»åŠ é™°å½± */
}

.btn-search:hover {
    background: linear-gradient(135deg, #21867a 0%, #1a6b5f 100%);
    transform: translateY(-2px); /* æ‡¸åœæ™‚ä¸Šç§» */
    box-shadow: 0 4px 8px rgba(42, 157, 143, 0.3); /* å¢å¼·é™°å½± */
}

.btn-search:active {
    transform: translateY(0); /* é»æ“Šæ™‚æ¢å¾© */
    box-shadow: 0 2px 4px rgba(42, 157, 143, 0.2);
}

.btn-clear {
    flex: 0 0 25%; /* å›ºå®šä½” 25% å¯¬åº¦ */
    padding: 12px 20px;
    background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%); /* æ¼¸è®ŠèƒŒæ™¯ */
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600; /* åŠ ç²—å­—é«” */
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(108, 117, 125, 0.2); /* æ·»åŠ é™°å½± */
}

.btn-clear:hover {
    background: linear-gradient(135deg, #5a6268 0%, #495057 100%);
    transform: translateY(-2px); /* æ‡¸åœæ™‚ä¸Šç§» */
    box-shadow: 0 4px 8px rgba(108, 117, 125, 0.3); /* å¢å¼·é™°å½± */
}

.btn-clear:active {
    transform: translateY(0); /* é»æ“Šæ™‚æ¢å¾© */
    box-shadow: 0 2px 4px rgba(108, 117, 125, 0.2);
}

.product-container {
display: flex;
flex-wrap: wrap;
gap: 12px;
margin-top: 20px;
min-height: 100px;
}

.product-card {
border: 1px solid #ccc;
border-radius: 8px;
padding: 12px;
width: calc(33% - 12px);
box-shadow: 2px 2px 6px rgba(0,0,0,0.1);
text-align: center;
background-color: #f9f9f9;
transition: transform 0.2s, box-shadow 0.2s;
cursor: pointer;
}

.product-card:hover {
transform: translateY(-3px);
box-shadow: 3px 3px 10px rgba(0,0,0,0.2);
background-color: #f0f0f0;
}

.product-id {
font-size: 0.8em;
color: #666;
margin-bottom: 4px;
}

.product-name {
font-weight: bold;
font-size: 1.1em;
margin-bottom: 8px;
color: #264653;
}

.product-price {
color: #2a9d8f;
font-size: 1em;
margin-bottom: 4px;
}

.product-subclass {
font-size: 0.9em;
color: #e76f51;
font-style: italic;
}

input {
display: block;
width: 100%;
margin: 10px 0;
padding: 8px;
border: 1px solid #ccc;
border-radius: 4px;
box-sizing: border-box;
}

button {
width: 100%;
padding: 10px;
background-color: #2a9d8f;
color: white;
border: none;
border-radius: 4px;
cursor: pointer;
font-size: 1em;
}

button:hover {
background-color: #21867a;
}

.no-results {
text-align: center;
padding: 40px;
color: #666;
font-size: 1.1em;
width: 100%;
}
</style>
<script>
let currentSearchTerm = '';

// é é¢è¼‰å…¥æ™‚è‡ªå‹•ç²å–ç”¢å“
window.addEventListener('DOMContentLoaded', function() {
loadProducts();
});

// è™•ç†æœç´¢æ¡†çš„ Enter éµ
function handleSearch(event) {
if (event.key === 'Enter') {
searchProducts();
}
}

// æœç´¢ç”¢å“
function searchProducts() {
const searchInput = document.getElementById('searchInput');
currentSearchTerm = searchInput.value.trim();
loadProducts(currentSearchTerm);
}

// æ¸…é™¤æœç´¢
function clearSearch() {
document.getElementById('searchInput').value = '';
currentSearchTerm = '';
loadProducts();
}

// è¼‰å…¥ç”¢å“åˆ—è¡¨
function loadProducts(searchTerm = '') {
let url = '/api/products?limit=100';
if (searchTerm) {
url += `&search=${encodeURIComponent(searchTerm)}`;
}

fetch(url)
.then(response => {
if (!response.ok) {
throw new Error('Network response was not ok');
}
return response.json();
})
.then(products => {
const container = document.getElementById('productContainer');
container.innerHTML = '';

if (products.length === 0) {
if (searchTerm) {
container.innerHTML = `<div class="no-results">No products found matching "${searchTerm}"</div>`;
} else {
container.innerHTML = '<p class="no-results">No product data available</p>';
}
return;
}

products.forEach(product => {
const productCard = document.createElement('div');
productCard.className = 'product-card';
productCard.onclick = () => editProduct(product.id);
productCard.innerHTML = `
<div class="product-id">ID: ${product.id}</div>
<div class="product-name">${product.name}</div>
<div class="product-price">$${parseFloat(product.price).toFixed(2)}</div>
<div class="product-subclass">${product.subclass}</div>
`;
container.appendChild(productCard);
});
})
.catch(error => {
console.error('Error loading products:', error);
document.getElementById('productContainer').innerHTML =
'<p style="color: red;">Failed to load products. Please try again later.</p>';
});
}

// é»æ“Šç”¢å“å¡ç‰‡ï¼Œè·³è½‰åˆ°ç·¨è¼¯é é¢
function editProduct(productId) {
window.location.href = `/products/edit/${productId}`;
}

// æ·»åŠ ç”¢å“
function add_product() {
const productId = document.getElementById('productId').value;
const name = document.getElementById('name').value;
const price = document.getElementById('price').value;
const subclass = document.getElementById('subclass').value;

if (!productId || !name || !price || !subclass) {
alert('Please fill in all fields');
return;
}

fetch('/api/products', {
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify({ 
id: productId,
name: name, 
price: parseFloat(price),
subclass: subclass
})
})
.then(response => {
if (!response.ok) {
return response.json().then(err => {
throw new Error(err.message || 'Network response was not ok');
});
}
return response.json();
})
.then(data => {
alert(data.message);
document.getElementById('productId').value = '';
document.getElementById('name').value = '';
document.getElementById('price').value = '';
document.getElementById('subclass').value = '';
loadProducts(currentSearchTerm);
})
.catch(error => {
console.error('Error adding product:', error);
alert('Failed to add product: ' + error.message);
});
}
</script>
{% endblock %}