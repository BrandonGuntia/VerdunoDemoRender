{% extends "base.html" %}
{% block title %}Admin 管理{% endblock %}

{% block content %}

  <!-- 原本 admin.html 內容 -->
  <div class="card">
    <h2>客戶帳號管理</h2>
    <form method="POST">
      <input type="hidden" name="action" value="add_customer">
      <label>新客戶帳號：</label><br>
      <input type="text" name="username" required><br>
      <label>密碼：</label><br>
      <input type="password" name="password" required><br><br>
      <button type="submit" class="btn btn-success">新增客戶</button>
    </form>
  </div>

  <div class="card">
    <h2>現有帳號</h2>
    <table border="1" cellpadding="8" cellspacing="0" width="100%">
      <tr>
        <th>ID</th>
        <th>帳號</th>
        <th>是否為 Admin</th>
        <th>操作</th>
      </tr>
      {% for u in users %}
      <tr>
        <td>{{ u.id }}</td>
        <td>{{ u.username }}</td>
        <td>{{ "是" if u.is_admin else "否" }}</td>
        <td>
          {% if not u.is_admin %}
          <form method="POST" style="display:inline;">
            <input type="hidden" name="action" value="delete_customer">
            <input type="hidden" name="user_id" value="{{ u.id }}">
            <button type="submit" class="btn btn-danger">刪除</button>
          </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>

  <div class="card">
    <h2>客戶專屬產品管理</h2>
    <form method="POST">
      <input type="hidden" name="action" value="add_user_item">
      <label>選擇客戶：</label>
      <select name="user_id" required>
        {% for u in users if not u.is_admin %}
          <option value="{{ u.id }}">{{ u.username }}</option>
        {% endfor %}
      </select><br><br>

      <label>選擇產品：</label>
      <select name="item_id" required>
        {% for i in items %}
          <option value="{{ i.id }}">{{ i.product_name }}</option>
        {% endfor %}
      </select><br><br>

      <label>專屬價格 (可留空使用產品原價)：</label><br>
      <input type="number" step="0.01" name="custom_price"><br><br>

      <button type="submit" class="btn btn-success">新增專屬產品</button>
    </form>
  </div>

  <div class="card">
    <h2>現有客戶產品對應</h2>
    <table border="1" cellpadding="8" cellspacing="0" width="100%">
      <tr>
        <th>客戶</th>
        <th>產品</th>
        <th>專屬價格</th>
        <th>操作</th>
      </tr>
      {% for ui in user_items %}
      <tr>
        <td>{{ ui.owner.username }}</td>
        <td>{{ ui.item.product_name }}</td>
        <td>
          {% if ui.custom_price %}
            {{ ui.custom_price }}
          {% else %}
            {{ ui.item.price_per_kg }}
          {% endif %}
        </td>
        <td>
          <form method="POST" style="display:inline;">
            <input type="hidden" name="action" value="delete_user_item">
            <input type="hidden" name="user_item_id" value="{{ ui.id }}">
            <button type="submit" class="btn btn-danger">刪除</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>

{% endblock %}
