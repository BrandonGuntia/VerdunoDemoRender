{% extends "base.html" %}
{% block title %}Edit Product{% endblock %}
{% block content %}
<div class="main">
<div class="card">
<h2>Edit Product</h2>
<div id="loading">Loading...</div>
<div id="editForm" style="display: none;">
<div class="form-group">
<label>Product ID:</label>
<input id="productId" readonly>
</div>
<div class="form-group">
<label>Product Name:</label>
<input id="name" placeholder="Product Name">
</div>
<div class="form-group">
<label>Price:</label>
<input id="price" placeholder="Price" type="number" step="0.01">
</div>
<div class="form-group">
<label>Subclass:</label>
<input id="subclass" placeholder="Subclass">
</div>
<div class="button-group">
<button onclick="updateProduct()" class="btn-primary">Update</button>
<button onclick="deleteProduct()" class="btn-danger">Delete</button>
<button onclick="goBack()" class="btn-secondary">Back</button>
</div>
</div>
</div>
</div>
<style>
.form-group {
margin-bottom: 15px;
}

.form-group label {
display: block;
font-weight: bold;
margin-bottom: 5px;
color: #264653;
}

input {
display: block;
width: 100%;
padding: 10px;
border: 1px solid #ccc;
border-radius: 4px;
box-sizing: border-box;
font-size: 1em;
}

input:readonly {
background-color: #f0f0f0;
cursor: not-allowed;
}

.button-group {
display: flex;
gap: 10px;
margin-top: 20px;
}

button {
flex: 1;
padding: 12px;
border: none;
border-radius: 4px;
cursor: pointer;
font-size: 1em;
font-weight: bold;
}

.btn-primary {
background-color: #2a9d8f;
color: white;
}

.btn-primary:hover {
background-color: #21867a;
}

.btn-danger {
background-color: #e76f51;
color: white;
}

.btn-danger:hover {
background-color: #d15b42;
}

.btn-secondary {
background-color: #6c757d;
color: white;
}

.btn-secondary:hover {
background-color: #5a6268;
}

#loading {
text-align: center;
padding: 20px;
color: #666;
}
</style>
<script>
let currentProductId = null;

// 從 URL 獲取產品 ID
window.addEventListener('DOMContentLoaded', function() {
const pathParts = window.location.pathname.split('/');
currentProductId = pathParts[pathParts.length - 1];
loadProduct();
});

// 載入產品資料
function loadProduct() {
fetch(`/api/products/${currentProductId}`)
.then(response => {
if (!response.ok) {
throw new Error('Product not found');
}
return response.json();
})
.then(product => {
document.getElementById('productId').value = product.id;
document.getElementById('name').value = product.name;
document.getElementById('price').value = product.price;
document.getElementById('subclass').value = product.subclass;
document.getElementById('loading').style.display = 'none';
document.getElementById('editForm').style.display = 'block';
})
.catch(error => {
console.error('Error loading product:', error);
document.getElementById('loading').innerHTML = 
'<p style="color: red;">載入產品失敗</p>';
});
}

// 更新產品
function updateProduct() {
const name = document.getElementById('name').value;
const price = document.getElementById('price').value;
const subclass = document.getElementById('subclass').value;

if (!name || !price || !subclass) {
alert('請填寫所有欄位');
return;
}

fetch(`/api/products/${currentProductId}`, {
method: 'PUT',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify({
name: name,
price: parseFloat(price),
subclass: subclass
})
})
.then(response => {
if (!response.ok) {
throw new Error('Update failed');
}
return response.json();
})
.then(data => {
alert(data.message);
window.location.href = '/products';
})
.catch(error => {
console.error('Error updating product:', error);
alert('更新產品失敗');
});
}

// 刪除產品
function deleteProduct() {
if (!confirm('確定要刪除這個產品嗎？')) {
return;
}

fetch(`/api/products/${currentProductId}`, {
method: 'DELETE'
})
.then(response => {
if (!response.ok) {
throw new Error('Delete failed');
}
return response.json();
})
.then(data => {
alert(data.message);
window.location.href = '/products';
})
.catch(error => {
console.error('Error deleting product:', error);
alert('刪除產品失敗');
});
}

// 返回產品列表
function goBack() {
window.location.href = '/products';
}
</script>
{% endblock %}